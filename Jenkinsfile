pipeline {
    agent any
    

    stages {
        stage('Deploy To Kubernetes') {
            steps {
                withkubeconfig(caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTmNZOURSbU40S1F3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBMU1ERXdNREE0TlROYUZ3MHpOREEwTWprd01ERXpOVE5hTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUM3eVM5UUZJWjhMQk81Y1VIZngyQmNJazBLT3ZSc2V6RW9sT1pPVGJZak5RV0N5SjlXSGhYQlg3dTUKQnJvQUUzZDJwOTdtakxNSHpwcGRoZGVzUWhQMGF6UWk4bzMrYVVYdDVLdENQWnl3d1o3R3E5NkNZTkRlZ3Q4ZwpLRkc4MkVIUUVmMm83SmVWcDhEQ09waGxVbU4yUmRVZ0dRcmdWclZJcVZWTnNNRUlQdE1RbFRuVXdhdGZFSVR1Cm82emdQT1c0cFZaaGt2b3BGL0RGUGlrM0dwam9ub0ZOYU9FbnNuUWtMT1gwZTZTOGVsSjFTeDVlUncyZWtYeGQKUngxMjEwQmFxajJGMElpNEJIVUE2a3VUR1lqVklleW9paWZYclpnR0hmenJxMXp2M1ZwMnRzbDYySjNKV0hrbwozYkNoS3NxRHhqc1BtYUpRNEx2UWhFMjNBZWFyQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJRemk1WXNWajRlS3pZUmhjRCtqbE1rdWg0R09qQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQkNLS1gyZktjZgpIdEJGMU9pZ3BwKzJuZmZIamdzaXR2Z0NmNjJxMXNMQ05yck10REYvb3lVTGJzcHVNWE5OZzVRUDdmZHQ1SWsvCmJ4VXdta2Q0RzRTSGxON0VXMk15SUNLdjBaWnZUMnliV1JGUVRxck9yaG1zcktjdVB4K1RoQndhWXFKcjJCbGgKcitOamVrajFBUG9FU2JsWXU5RHdqVXROcDhoay9YSkcvYzRnU3RPS2lmZ080M3ZNNFBmbTJ5VUtqOXpjZVBEQgpPaUg4eEdJUmU4N3NVbTlSaVM4OUMzZzAyMDEzKzMzMXdsUFA4THZIUzY3S2ZNREozUmtXUUI5VzFyNWI4VlFFCkpLaUdRV2NhdFdBcm9ucFVSbmIzYWFMZG1aa282cWV3NGZNYlo2WU5EWEsvVXo4RlZPQTE3R3d5YWxnTFN0L1gKdHZyYTUzVkpJN1JUCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K', credentialsId: 'k8-token', serverUrl: 'https://53E678C3A4D461B399B229688F6FC3EB.gr7.us-east-1.eks.amazonaws.com'){
                    sh "kubectl apply -f deployment-service.yaml"
                    sleep 60
                    
                }
            }
        }
        
        stage('verify Deployment') {
            steps {
                withkubeconfig(caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTmNZOURSbU40S1F3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBMU1ERXdNREE0TlROYUZ3MHpOREEwTWprd01ERXpOVE5hTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUM3eVM5UUZJWjhMQk81Y1VIZngyQmNJazBLT3ZSc2V6RW9sT1pPVGJZak5RV0N5SjlXSGhYQlg3dTUKQnJvQUUzZDJwOTdtakxNSHpwcGRoZGVzUWhQMGF6UWk4bzMrYVVYdDVLdENQWnl3d1o3R3E5NkNZTkRlZ3Q4ZwpLRkc4MkVIUUVmMm83SmVWcDhEQ09waGxVbU4yUmRVZ0dRcmdWclZJcVZWTnNNRUlQdE1RbFRuVXdhdGZFSVR1Cm82emdQT1c0cFZaaGt2b3BGL0RGUGlrM0dwam9ub0ZOYU9FbnNuUWtMT1gwZTZTOGVsSjFTeDVlUncyZWtYeGQKUngxMjEwQmFxajJGMElpNEJIVUE2a3VUR1lqVklleW9paWZYclpnR0hmenJxMXp2M1ZwMnRzbDYySjNKV0hrbwozYkNoS3NxRHhqc1BtYUpRNEx2UWhFMjNBZWFyQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJRemk1WXNWajRlS3pZUmhjRCtqbE1rdWg0R09qQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQkNLS1gyZktjZgpIdEJGMU9pZ3BwKzJuZmZIamdzaXR2Z0NmNjJxMXNMQ05yck10REYvb3lVTGJzcHVNWE5OZzVRUDdmZHQ1SWsvCmJ4VXdta2Q0RzRTSGxON0VXMk15SUNLdjBaWnZUMnliV1JGUVRxck9yaG1zcktjdVB4K1RoQndhWXFKcjJCbGgKcitOamVrajFBUG9FU2JsWXU5RHdqVXROcDhoay9YSkcvYzRnU3RPS2lmZ080M3ZNNFBmbTJ5VUtqOXpjZVBEQgpPaUg4eEdJUmU4N3NVbTlSaVM4OUMzZzAyMDEzKzMzMXdsUFA4THZIUzY3S2ZNREozUmtXUUI5VzFyNWI4VlFFCkpLaUdRV2NhdFdBcm9ucFVSbmIzYWFMZG1aa282cWV3NGZNYlo2WU5EWEsvVXo4RlZPQTE3R3d5YWxnTFN0L1gKdHZyYTUzVkpJN1JUCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K', credentialsId: 'k8-token', serverUrl: 'https://53E678C3A4D461B399B229688F6FC3EB.gr7.us-east-1.eks.amazonaws.com'){
                    sh "kubectl get svc -n webapps"
                }
            }
        }
    }
}
